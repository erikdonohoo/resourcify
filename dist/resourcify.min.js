/*! resourcify 08-12-2014 v0.1.0-alpha.1 */
!function(a,b){"use strict";function c(){function b(a){this.$cache={},this.$options=a,this.$lists={}}return b.prototype.add=function(b,c){for(var d=this.getKey(b),e=this.$cache,f=0;f<d.length-1;f++)e[d[f]]||(e[d[f]]={}),e=e[d[f]];if(e[d[d.length-1]])return a.extend(e[d[d.length-1]],b),e[d[d.length-1]];c&&a.forEach(this.$lists,function(a){a.$$invalid=!0});var g=this;return b.$clearCache=function(){g.remove(g.getKey(this))}.bind(b),e[d[d.length-1]]=b},b.prototype.getKey=function(b){var c=[],d=a.isArray(this.$options.key)?this.$options.key:[this.$options.key];return d.forEach(function(a){c.push(b[a])}),c},b.prototype.remove=function(b){a.isArray(b)||(b=[b]);for(var c=this.$cache,d=0;d<b.length-1;d++)c=c[b[d]];delete c[b[b.length-1]]},b.prototype.clear=function(){this.$cache={},this.$lists={}},b.prototype.get=function(b){a.isArray(b)||(b=[b]);for(var c=this.$cache,d=0;d<b.length-1;d++)c=c[b[d]];return c[b[b.length-1]]},b.prototype.getList=function(a){return this.$lists[a]?this.$lists[a]:null},b.prototype.addList=function(b,c){return this.$lists[b]?(console.log("merge"),a.forEach(c,function(c){var d=!1;c=this.add(c),a.forEach(this.$lists[b],function(a){c===a&&(d=!0)}.bind(this)),d||this.$lists[b].push(c)}.bind(this))):(console.log("first"),this.$lists[b]=c,a.forEach(c,function(a){this.add(a)}.bind(this))),this.$lists[b]},{createCache:function(a){return new b(a)}}}function d(a,b){return new Function("return function (call) { return function "+a+" () { return call(this, arguments) }; };")()(Function.apply.bind(b))}function e(c,e,f,g,h){function i(b,c,f){if(!b||!c)throw new Error("Must supply a name and a url when constructing");this.url=e.when(c),this.name=b,this.config=f||{};var h=this;this.$$ResourceConstructor=d(this.name,function(b){a.extend(this,b),(h.config.constructor||a.noop).bind(this)(b)}),this.$$ResourceConstructor.$$builder=this,this.config.cache&&(this.cache=g.createCache(this.config.cache),this.$$ResourceConstructor.$clearCache=this.cache.clear)}function j(b,c){if(!b.method||!b.name)throw new Error("Request config must contain a HTTP method and a name");b.$Const=c,b.isInstance?(c.prototype[b.name]=k(b),b.$Const.$$builder.cache&&(c.prototype[b.name].force=k(a.extend({$force:!0},b)))):(c[b.name]=k(b),b.$Const.$$builder.cache&&(c[b.name].force=k(a.extend({$force:!0},b))))}function k(d){return function(g,i,j){var k=this instanceof d.$Const?this:d.isArray?[]:new d.$Const({}),l=d.$Const.$$builder.cache;d.$Const.pending=d.$Const.pending||[],a.isFunction(g)?(j=i||a.noop,i=g,g={}):(g=g||{},i=i||a.noop,j=j||a.noop),d.$defer=e.defer(),k.$promise=d.$defer.promise,k.$resolved=!1;var m=!1;if(l)if(a.isArray(k))if(d.$Const.$$builder.$path){var n=l.getList(f.replaceParams(g,d.$Const.$$builder.$path,k));n&&(k=n)}else m=!0;else{var o=l.get(l.getKey(a.extend({},g,k)));o?k=o:m=!0}return l&&(k.$$invalid||m)||!l||d.$force?d.$Const.$$builder.url.then(function(e){d.$Const.$$builder.$path=d.$Const.$$builder.$path||e;var h=f.replaceParams(g,e,k),m={url:h,method:d.method};if(l)if(d.isArray){if(l.getList(h))return k=l.getList(h),void console.log("leaving");k=l.addList(h,k)}else if(l.get(l.getKey(a.extend({},g,k))))return void(k=l.get(l.getKey(a.extend({},g,k))));m.data=/^(POST|PUT|PATCH|DELETE)$/i.test(d.method)?k:b,c(m).then(function(b){if(d.isArray&&!a.isArray(b.data)||!d.isArray&&a.isArray(b.data))throw new Error("Saw array or object when expecting the opposite when making "+d.method+" call to "+h);d.isArray?(a.forEach(b.data,function(a){k.push("object"==typeof a?new d.$Const(a):a)}),l&&(k=l.addList(h,k))):(k="object"==typeof b.data?a.extend(k,b.data):b.data,l&&(k=l.add(k,"POST"===d.method?!0:!1))),l&&(k.$$invalid=!1),k.$resolved=!0,k.$url=h,i(k),d.$defer.resolve(k)},function(a){j(a),d.$defer.reject(a)})},function(){throw new Error("Could not resolve URL for "+d)}):h(function(){k.$resolved=!0,i(k),d.$defer.resolve(k)}),k}}return i.prototype.method=function(a,b){return this.$$ResourceConstructor.prototype[a]=b,this},i.prototype.request=function(a){return j(a,this.$$ResourceConstructor),this},i.prototype.create=function(){return this.$$ResourceConstructor},i}function f(a){var b={},c=a.substring(a.indexOf("?"));return c!==a&&c.replace(new RegExp("([^?=&]+)(=([^&]*))?","g"),function(a,c,d,e){b[c]=e}),b}function g(){function b(b,c,d){var e,g=/[\/=](:\w*[a-zA-Z]\w*)/,h=a.copy(c),i="__|cut|__";d=d||{};var j=f(h),k={};for(-1!==h.indexOf("?")&&(h=h.substring(0,h.indexOf("?"))),a.forEach(j,function(a,c){var e=a.substring(1);":"===a.charAt(0)&&(b[e]||d[e])?(k[c]=b[e]||d[e],delete b[e]):":"!==a.charAt(0)&&(k[c]=a)});e=g.exec(h);){var l=e[1],m=e[1].substring(1);if(h=h.replace(l,b[m]||d[m]||i),b[m])delete b[m];else if(-1!==h.indexOf("/"+i)){h=h.substring(0,h.indexOf("/"+i));break}}b=a.extend({},k,b);var n=[];return a.forEach(b,function(a,b){n.push(b+"="+a)}),h+=(n.length?"?":"")+n.join("&")}return{replaceParams:b}}a.module("resourcify",[]),a.module("resourcify").factory("ResourcifyCache",c),e.$inject=["$http","$q","resourcifyUtils","ResourcifyCache","$timeout"],a.module("resourcify").service("Resourcify",e),a.module("resourcify").factory("resourcifyUtils",g)}(angular);