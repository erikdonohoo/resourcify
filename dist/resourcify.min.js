/*! resourcify 09-03-2015 v1.0.5 */
!function(a,b){"use strict";function c(b,c){a.forEach(c,function(a){-1!==a.indexOf(b)&&a.splice(a.indexOf(b),1)})}function d(){function b(b){this.$cache={},this.$options=a.extend({id:"id",saveMethod:"POST",key:["id"]},b||{}),this.$lists={}}return b.prototype.isCacheable=function(a){return!a.noCache&&!a.$force&&"GET"===a.method},b.prototype.add=function(b,c){for(var d=this.getKey(b),e=this.$cache,f=0;f<d.length-1;f++)e[d[f]]||(e[d[f]]={}),e=e[d[f]];if(e[d[d.length-1]])return a.extend(e[d[d.length-1]],b),e[d[d.length-1]];c&&a.forEach(this.$lists,function(a){a.$invalid=!0});var g=this;return b.$clearCache=function(){g.remove(g.getKey(this))}.bind(b),e[d[d.length-1]]=b},b.prototype.getKey=function(b){var c=[],d=a.isArray(this.$options.key)?this.$options.key:[this.$options.key];return d.forEach(function(a){c.push(b[a])}),c},b.prototype.remove=function(b){a.isArray(b)||(b=[b]);for(var d=this.$cache,e=0;e<b.length-1;e++)d=d[b[e]];var f=d[b[b.length-1]];c(f,this.$lists),delete d[b[b.length-1]]},b.prototype.clear=function(){this.$cache={},this.$lists={}},b.prototype.get=function(b){a.isArray(b)||(b=[b]);for(var c=this.$cache,d=0;d<b.length-1;d++)c=c[b[d]];return c[b[b.length-1]]},b.prototype.getList=function(a){return this.$lists[a]?this.$lists[a]:null},b.prototype.addList=function(b,c){if(this.$lists[b])a.forEach(c,function(c){var d=!1;c=this.add(c),a.forEach(this.$lists[b],function(a){c===a&&(d=!0)}.bind(this)),d||this.$lists[b].push(c)}.bind(this));else{this.$lists[b]=c;for(var d=0;d<c.length;d++)c[d]=this.add(c[d])}return this.$lists[b]},{createCache:function(a){return new b(a)}}}function e(a,b){return new Function("return function (call) { return function "+a+" () { return call(this, arguments) }; };")()(Function.apply.bind(b))}function f(a){var b=a.toString();return b=b.substr("function ".length),b=b.substr(0,b.indexOf("("))}function g(b){function c(){b.apply(this,arguments)}c.prototype=new b;for(var d in b)b.hasOwnProperty(d)&&(c[d]=a.copy(b[d]));return c}function h(b,c){var d={},e=c[3],f=c[0],g=c[1],h=c[2];switch(d.error=d.success=a.noop,d.params=d.body={},c.length){case 4:d.error=e,d.success=h;case 3:case 2:if(!a.isFunction(g)){d.params=f,d.body=g,d.success=h||a.noop;break}if(a.isFunction(f)){d.success=f,d.error=g;break}d.success=g,d.error=h||a.noop;case 1:a.isFunction(f)?d.success=f:/^(POST|PUT|PATCH)$/i.test(b)?d.body=f:d.params=f;break;case 0:break;default:throw new Error("Expected up to 4 arguments [params, data, success, error], got "+c.length+" args")}return d}function i(c,d,i,j){function k(b,c,h){if(!b||!c)throw new Error("Must supply a name and a url when constructing");this.url=d.when(c),this.name=b,this.config=h||{},this.config.idProp=this.config.idProp||"id",this.config.usePromise=null!=this.config.usePromise?this.config.usePromise:this.config.cache?!0:!1,this.config.httpConfig=this.config.httpConfig||{},this.subs=[];var i=this;this.$$ResourceConstructor=e(this.name,function(b){a.extend(this,b||{}),a.forEach(i.subs,function(a){var b=a[0],c=a[1],d=f(b),e=g(b);e.prototype.$paramMap=c,e.prototype.$parentItem=this,this[d]=e},this),(i.config.constructor||a.noop).bind(this)(b)}),this.$$ResourceConstructor.$$builder=this,this.config.cache&&(this.cache=j.createCache(a.isObject(this.config.cache)?this.config.cache:{}),this.$$ResourceConstructor.$clearCache=this.cache.clear)}function l(b,c){if(!b.method||!b.name)throw new Error("Request config must contain a HTTP method and a name");if(b.url=b.url?d.when(b.url):null,b.$Const=c,b.isInstance=null==b.isInstance?!0:b.isInstance,b.config=b.config||{},b.isInstance===!1&&(b.before||b.after))throw new Error("Before/After functions not supported on Class level requests");b.isInstance?(c.prototype[b.name]=p(b),c.prototype[b.name].withConfig=function(){return i.extendDeep(b.config,arguments[0]),p(b).apply(this,[].slice.call(arguments,1))},b.$Const.$$builder.cache&&(c.prototype[b.name].force=p(a.extend({$force:!0},b)),c.prototype[b.name].force.withConfig=function(){return i.extendDeep(b.config,arguments[0]),p(a.extend({$force:!0},b)).apply(this,[].slice.call(arguments,1))})):(c[b.name]=p(b),c[b.name].withConfig=function(){return i.extendDeep(b.config,arguments[0]),p(b).apply(this,[].slice.call(arguments,1))},b.$Const.$$builder.cache&&(c[b.name].force=p(a.extend({$force:!0},b)),c[b.name].force.withConfig=function(){return i.extendDeep(b.config,arguments[0]),p(a.extend({$force:!0},b)).apply(this,[].slice.call(arguments,1))}))}function m(d,e,f,g,h,j){function k(){e.$resolved=!0,e.$url=d,g(e),e.$$defer.resolve(e),l&&l.resolve(e)}var l,m={url:d,method:f.method},n=f.$Const.$$builder.cache;if(n&&n.isCacheable(f))if(a.isArray(e)){var o=n.getList(d);if(o&&!o.$invalid)return l=e.$$defer,e=o,void k();e=n.addList(d,e)}else{var p=n.get(n.getKey(a.extend(e.$$params,e)));if(p&&!p.$invalid)return l=e.$$defer,e=p,void k();e[f.$Const.$$builder.config.idProp]?e=n.add(e):e.$$params[f.$Const.$$builder.config.idProp]&&(e[f.$Const.$$builder.config.idProp]=e.$$params[f.$Const.$$builder.config.idProp],e=n.add(e))}(f.before||a.noop).apply(e);var q={};a.isArray(e)||"GET"===f.method||a.forEach(e,function(a,b){e.hasOwnProperty(b)&&"$"!==b.charAt(0)&&(q[b]=a)});var r=f.$Const.$$builder.config.httpConfig;m.data=/^(POST|PUT|PATCH|DELETE)$/i.test(f.method)?q:b,c(i.extendDeep({},r,f.config||{},m)).then(function(b){var c=f.propName?b.data[f.propName]:b.data;if(f.isArray&&!a.isArray(c)||!f.isArray&&a.isArray(c))throw new Error("Saw array or object when expecting the opposite when making "+f.method+" call to "+d);if(f.isArray)a.forEach(c,function(a){var b="object"==typeof a?j.prototype instanceof f.$Const?new j(a):new f.$Const(a):{data:a};b.$invalid=f.invalidateListModels&&n,e.push(b)}),n&&!f.noCache&&(e=n.addList(d,e));else{e="object"==typeof c?a.extend(e,c):a.extend(e,{data:c});var g;(g=b.headers("Location"))&&(e[f.$Const.$$builder.config.idProp]=g.substring(g.lastIndexOf("/")+1)),n&&!f.noCache&&(e=n.add(e,f.method===n.$options.saveMethod))}n&&(e.$invalid=!1),e.$response=b,(f.after||a.noop).apply(e),k()},function(a){h(a),e.$$defer.reject(a)})}function n(b,c,d,e){var f={};return b.$parentItem&&(f=n(b.$parentItem,c,d,e+1)),a.forEach(d,function(a,c){var d,g;-1!==a.indexOf("@")?(d=a.substr(0,a.indexOf("@")),g=parseInt(a.substr(a.indexOf("@")+1))):(d=a,g=0),g&&g===e&&b[d]?f[c]=b[d]:0===g&&b[d]&&(f[c]=b[d])}),c=a.extend(f,c)}function o(b,c){return b.$parentItem&&(c=o(b.$parentItem,c)),a.forEach(b,function(a,d){b.hasOwnProperty(d)&&(c[d]=a)}),c}function p(a){return function(){var b=this,c=a.$Const.$$builder.cache,e=h(a.method,arguments),f=this instanceof a.$Const?this:a.isArray?[]:this.prototype instanceof a.$Const?new this(e.body):new a.$Const(e.body),g={};return(this.$parentItem||this.prototype&&this.prototype.$parentItem)&&(this.$paramMap||this.prototype&&this.prototype.$paramMap?e.params=n(this.$parentItem||this.prototype.$parentItem,e.params,this.$paramMap||this.prototype.$paramMap,1):g=o(this.$parentItem||this.prototype.$parentItem,g)),f.$$defer=d.defer(),f.$$params=e.params,f.$promise=f.$$defer.promise,f.$resolved=!1,(a.url||a.$Const.$$builder.url).then(function(c){m(i.replaceParams(e.params,c,f,g),f,a,e.success,e.error,b)}.bind(this),function(){throw new Error("Could not resolve URL for "+a.toString())}),c||a.$Const.$$builder.config.usePromise?f.$promise:f}}return k.prototype.subResource=function(a,b){return this.subs.push([a,b]),this},k.prototype.method=function(a,b){return this.$$ResourceConstructor.prototype[a]=b,this},k.prototype.request=function(a){return l(a,this.$$ResourceConstructor),this},k.prototype.create=function(){return this.$$ResourceConstructor},k}function j(a){var b={},c=a.substring(a.indexOf("?"));return c!==a&&c.replace(new RegExp("([^?=&]+)(=([^&]*))?","g"),function(a,c,d,e){b[c]=e}),b}function k(b){return a.forEach(arguments,function(c){c!==b&&a.forEach(c,function(a,c){b[c]&&b[c].constructor&&b[c].constructor===Object?k(b[c],a):b[c]=a})}),b}function l(){function b(b,c,d,e){var f,g=/[\/=.](:\w*[a-zA-Z]\w*)/,h=a.copy(c),i="__|cut|__",k=a.copy(b);d=d||{},e=e||{};var l=j(h),m={};for(-1!==h.indexOf("?")&&(h=h.substring(0,h.indexOf("?"))),a.forEach(l,function(a,b){var c=a.substring(1);":"===a.charAt(0)&&(k[c]||d[c]||e[c])?(m[b]=k[c]||d[c]||e[c],delete k[c]):":"!==a.charAt(0)&&(m[b]=a)});f=g.exec(h);){var n=f[1],o=f[1].substring(1);if(h=h.replace(n,k[o]||d[o]||e[o]||i),k[o])delete k[o];else if(-1!==h.indexOf("/"+i)){h=h.substring(0,h.indexOf("/"+i));break}}k=a.extend({},m,k);var p=[];return a.forEach(k,function(a,b){p.push(b+"="+a)}),h+=(p.length?"?":"")+p.join("&")}return{replaceParams:b,extendDeep:k}}a.module("resourcify",[]),a.module("resourcify").factory("ResourcifyCache",d),i.$inject=["$http","$q","resourcifyUtils","ResourcifyCache"],a.module("resourcify").service("Resourcify",i),a.module("resourcify").factory("resourcifyUtils",l)}(angular);